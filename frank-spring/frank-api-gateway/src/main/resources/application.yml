# ğŸŒ Frank API Gateway Configuration
# -----------------------
# Spring Boot application configuration
# Minimal configuration for Frank-API-Gateway microservice
#
# NOTES:
# - Reactive web application type is required for Spring Cloud Gateway
# - Basic routing is configured for hello, orchestrator, and SSE services
# - StripPrefix filter used as an example for path modification
# - Autoconfigure.exclude removed as keys are now correct
#
# Author: Edoardo Sabatini
# Date: 21 October 2025

# ğŸ–¥ï¸ Server configuration
server:
  port: 8081  # âœ… Gateway listening port

spring:
  application:
    name: frank-api-gateway
  main:
    web-application-type: reactive # ğŸ”„ Required for Spring Cloud Gateway

  cloud:
    gateway:
      server:
        webflux:
          routes:

            # ğŸ‘‹ Hello Endpoint
            - id: hello-endpoint
              uri: http://frankstack-orchestrator:8080
              predicates:
                - Path=/hello
              # âœ… Maps /hello requests to backend service

            # âš ï¸ Old orchestrator route commented out
            # - id: orchestrator-service
            #   uri: http://frankstack-orchestrator:8080
            #   predicates:
            #     - Path=/orchestrator/**
            #   filters:
            #     - StripPrefix=1 # Example only, breaks dynamic paths

            # âš ï¸ Old SSE route commented out
            # - id: hello-sse-service
            #   uri: http://frankstack-orchestrator:8080
            #   predicates:
            #     - Path=/sse/**
            #   filters:
            #     - StripPrefix=1 # Example only, not used

            # âœ… NEW ACTIVE ROUTE for orchestrator
            - id: frank-orchestrator
              uri: http://frankstack-orchestrator:8080
              predicates:
                - Path=/frankorchestrator/**
              # ğŸŒŠ Handles saga creation and SSE streaming

            # âœ… Kafka Producer route (internal)
            - id: kafka-producer-send
              uri: http://frankstack-kafka-travel-producer:8082
              predicates:
                - Path=/kafka/send/**
              # ğŸ“¨ Internal route for Kafka Producer service, not called directly by frontend
            
            # ğŸ§­ sendbooktravel
            - id: frank-orchestrator-sendbooktravel
              uri: http://frankstack-orchestrator:8080
              predicates:
                - Method=POST
                - Path=/frankorchestrator/sendbooktravel
              # ğŸ§© Used when user confirms selected transport to continue the saga

            # âœ… Kafka Producer route for booktravel (internal)
            - id: kafka-producer-booktravel
              uri: http://frankstack-kafka-travel-producer:8082
              predicates:
                - Path=/kafka/booktravel/**
              # ğŸ“¨ Internal route for Kafka Producer service, called by orchestrator

            # âœ… Kafka Producer route (internal)
            - id: kafka-producer-sendhotel
              uri: http://frankstack-kafka-hotel-producer:8086
              predicates:
                - Path=/kafka/sendhotel/**
              # ğŸ“¨ Internal route for Kafka Producer service, not called directly by frontend

            # ğŸ§­ sendbookhotel
            - id: frank-orchestrator-sendbookhotel
              uri: http://frankstack-orchestrator:8080
              predicates:
                - Method=POST
                - Path=/frankorchestrator/sendbookhotel
              # ğŸ§© Used when user confirms selected hotel to continue the saga

            # âœ… Kafka Producer route for bookhotel (internal)
            - id: kafka-producer-bookhotel
              uri: http://frankstack-kafka-hotel-producer:8086
              predicates:
                - Path=/kafka/bookhotel/**
              # ğŸ“¨ Internal route for Kafka Producer service, called by orchestrator

            # ğŸ’³ Webhook callback for card payment
            - id: frank-callback-card-payment-complete
              uri: http://frankstack-orchestrator:8080
              predicates:
                - Method=POST
                - Path=/frankcallback/**
              # ğŸ“¨ Routes POST /frankcallback to Webhook callback service
              
            # ğŸ’³ Payment card processing endpoint via Orchestrator
            - id: frank-orchestrator-paymentsprocess
              uri: http://frankstack-orchestrator:8080
              predicates:
                - Method=POST
                - Path=/frankorchestrator/paymentsprocess
              # ğŸ“¨ Routes POST /frankorchestrator/paymentsprocess to orchestrator service

            # ğŸ”’ Webhook callback to close saga once React has received the invoice
            - id: frank-callback-close-saga
              uri: http://frankstack-orchestrator:8080
              predicates:
                - Method=POST
                - Path=/frankcallback/closeSaga/**
              # ğŸ“¨ Routes POST /frankcallback/closeSaga to webhook service that closes the saga
